<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/calculators/ewa_favicon.png">
    <title>Bahrain Electricity Calculator 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        body.rtl {
            direction: rtl;
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
        }
        
        .calculator {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 32px;
            max-width: 450px;
            width: 100%;
        }
        
        .section-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 8px;
        }
        
        .section-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .section-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        h1 {
            color: #333;
            font-size: 24px;
            margin: 0;
        }
        
        .lang-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .lang-toggle:hover {
            transform: scale(1.05);
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .calc-mode {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 8px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .input-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            color: #555;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
            color: white;
        }
        
        .result-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .result-value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .breakdown {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.3);
            font-size: 13px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            opacity: 0.9;
        }
        
        .reverse-result {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            text-align: center;
        }
        
        .reverse-result-label {
            color: #666;
            font-size: 13px;
            margin-bottom: 4px;
        }
        
        .reverse-result-value {
            color: #667eea;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="header">
            <h1 id="mainTitle">âš¡ Utilities Calculator</h1>
            <button class="lang-toggle" onclick="toggleLanguage()" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        </div>
        <div class="subtitle" id="subtitle">Bahrain Domestic Rates 2019-2026</div>
        
        <div class="section-tabs">
            <button class="section-tab active" onclick="setSection('electricity')" id="electricityTab">âš¡ <span id="electricityText">Electricity</span></button>
            <button class="section-tab" onclick="setSection('water')" id="waterTab">ğŸ’§ <span id="waterText">Water</span></button>
        </div>
        
        <div id="electricitySection">
        
        <div class="calc-mode">
            <button class="mode-btn active" onclick="setMode('units')" id="unitsBtn">By Units</button>
            <button class="mode-btn" onclick="setMode('cost')" id="costBtn">By Cost</button>
        </div>
        
        <div class="input-group" id="unitsInput">
            <label for="units" id="unitsLabel">Enter Consumption Units:</label>
            <input type="number" id="units" placeholder="e.g., 4500" min="0" step="1">
        </div>
        
        <div class="input-group" id="costInput" style="display:none;">
            <label for="cost" id="costLabel">Enter Previous Cost (2019):</label>
            <input type="number" id="cost" placeholder="e.g., 25.500" min="0" step="0.001">
        </div>
        
        <div class="reverse-result" id="reverseResult" style="display:none;">
            <div class="reverse-result-label" id="estimatedLabel">Estimated Units</div>
            <div class="reverse-result-value" id="estimatedUnits">0</div>
        </div>
        
        <div class="result">
            <div class="result-label" id="prevLabel">Previous Rate (2019 Subsidy)</div>
            <div class="result-value" id="totalCost">0 BD</div>
            
            <div class="breakdown" id="breakdown"></div>
        </div>
        
        <div class="result" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); margin-top: 16px;">
            <div class="result-label" id="currentLabel">Current Rate (2026)</div>
            <div class="result-value" id="currentCost">0 BD</div>
            
            <div class="breakdown" id="currentBreakdown"></div>
        </div>
        </div>
        
        <div id="waterSection" style="display:none;">
        <div class="calc-mode">
            <button class="mode-btn active" onclick="setMode('units')" id="waterUnitsBtn">By Units</button>
            <button class="mode-btn" onclick="setMode('cost')" id="waterCostBtn">By Cost</button>
        </div>
        
        <div class="input-group" id="waterUnitsInput">
            <label for="waterUnits" id="waterUnitsLabel">Enter Water Consumption (mÂ³):</label>
            <input type="number" id="waterUnits" placeholder="e.g., 75" min="0" step="1">
        </div>
        
        <div class="input-group" id="waterCostInput" style="display:none;">
            <label for="waterCost" id="waterCostLabel">Enter Previous Water Cost (2019):</label>
            <input type="number" id="waterCost" placeholder="e.g., 15.000" min="0" step="0.001">
        </div>
        
        <div class="reverse-result" id="waterReverseResult" style="display:none;">
            <div class="reverse-result-label" id="waterEstimatedLabel">Estimated Consumption (mÂ³)</div>
            <div class="reverse-result-value" id="waterEstimatedUnits">0</div>
        </div>
        
        <div class="result">
            <div class="result-label" id="waterPrevLabel">Previous Rate (2019)</div>
            <div class="result-value" id="waterTotalCost">0 BD</div>
            
            <div class="breakdown" id="waterBreakdown"></div>
        </div>
        
        <div class="result" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); margin-top: 16px;">
            <div class="result-label" id="waterCurrentLabel">Current Rate (2026)</div>
            <div class="result-value" id="waterCurrentCost">0 BD</div>
            
            <div class="breakdown" id="waterCurrentBreakdown"></div>
        </div>
        </div>
    </div>
    
    <script>
        let currentLang = 'en';
        let currentMode = 'units';
        let currentSection = 'electricity';
        
        const translations = {
            en: {
                mainTitle: 'âš¡ğŸ’§ Utilities Calculator',
                subtitle: 'Bahrain Domestic Rates 2019-2026',
                electricityText: 'Electricity',
                waterText: 'Water',
                unitsBtn: 'By Units',
                costBtn: 'By Cost',
                unitsLabel: 'Enter Consumption Units:',
                costLabel: 'Enter Previous Cost (2019):',
                waterUnitsLabel: 'Enter Water Consumption (mÂ³):',
                waterCostLabel: 'Enter Previous Water Cost (2019):',
                estimatedLabel: 'Estimated Units',
                waterEstimatedLabel: 'Estimated Consumption (mÂ³)',
                prevLabel: 'Previous Rate (2019 Subsidy)',
                currentLabel: 'Current Rate (2026)',
                waterPrevLabel: 'Previous Rate (2019)',
                waterCurrentLabel: 'Current Rate (2026)',
                unitsPlaceholder: 'e.g., 4500',
                costPlaceholder: 'e.g., 25.500',
                waterUnitsPlaceholder: 'e.g., 75',
                waterCostPlaceholder: 'e.g., 15.000',
                fils: 'fils',
                units: 'units',
                cubicMeters: 'mÂ³',
                more: 'more',
                less: 'less',
                difference: 'Difference',
                sameCost: 'Same cost'
            },
            ar: {
                mainTitle: 'âš¡ğŸ’§ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚',
                subtitle: 'ØªØ¹Ø±ÙØ© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© Ù¢Ù Ù¡Ù©-Ù¢Ù Ù¢Ù¦',
                electricityText: 'Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡',
                waterText: 'Ø§Ù„Ù…ÙŠØ§Ù‡',
                unitsBtn: 'Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø§Øª',
                costBtn: 'Ø­Ø³Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©',
                unitsLabel: 'Ø£Ø¯Ø®Ù„ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ:',
                costLabel: 'Ø£Ø¯Ø®Ù„ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù¢Ù Ù¡Ù©):',
                waterUnitsLabel: 'Ø£Ø¯Ø®Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡ (Ù…Â³):',
                waterCostLabel: 'Ø£Ø¯Ø®Ù„ ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù¢Ù Ù¡Ù©):',
                estimatedLabel: 'Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©',
                waterEstimatedLabel: 'Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ù‚Ø¯Ø± (Ù…Â³)',
                prevLabel: 'Ø§Ù„ØªØ¹Ø±ÙØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø¯Ø¹Ù… Ù¢Ù Ù¡Ù©)',
                currentLabel: 'Ø§Ù„ØªØ¹Ø±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù¢Ù Ù¢Ù¦)',
                waterPrevLabel: 'Ø§Ù„ØªØ¹Ø±ÙØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù¢Ù Ù¡Ù©)',
                waterCurrentLabel: 'Ø§Ù„ØªØ¹Ø±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù¢Ù Ù¢Ù¦)',
                unitsPlaceholder: 'Ù…Ø«Ø§Ù„: Ù¤Ù¥Ù Ù ',
                costPlaceholder: 'Ù…Ø«Ø§Ù„: Ù¢Ù¥.Ù¥Ù Ù ',
                waterUnitsPlaceholder: 'Ù…Ø«Ø§Ù„: Ù§Ù¥',
                waterCostPlaceholder: 'Ù…Ø«Ø§Ù„: Ù¡Ù¥.Ù Ù Ù ',
                fils: 'ÙÙ„Ø³',
                units: 'ÙˆØ­Ø¯Ø©',
                cubicMeters: 'Ù…Â³',
                more: 'Ø£ÙƒØ«Ø±',
                less: 'Ø£Ù‚Ù„',
                difference: 'Ø§Ù„ÙØ±Ù‚',
                sameCost: 'Ù†ÙØ³ Ø§Ù„ØªÙƒÙ„ÙØ©'
            }
        };
        
        function setSection(section) {
            currentSection = section;
            document.getElementById('electricityTab').classList.toggle('active', section === 'electricity');
            document.getElementById('waterTab').classList.toggle('active', section === 'water');
            document.getElementById('electricitySection').style.display = section === 'electricity' ? 'block' : 'none';
            document.getElementById('waterSection').style.display = section === 'water' ? 'block' : 'none';
        }
        
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            document.body.classList.toggle('rtl', currentLang === 'ar');
            document.getElementById('langBtn').textContent = currentLang === 'en' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English';
            
            // Update all text
            const t = translations[currentLang];
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('electricityText').textContent = t.electricityText;
            document.getElementById('waterText').textContent = t.waterText;
            document.getElementById('unitsBtn').textContent = t.unitsBtn;
            document.getElementById('costBtn').textContent = t.costBtn;
            document.getElementById('waterUnitsBtn').textContent = t.unitsBtn;
            document.getElementById('waterCostBtn').textContent = t.costBtn;
            document.getElementById('unitsLabel').textContent = t.unitsLabel;
            document.getElementById('costLabel').textContent = t.costLabel;
            document.getElementById('waterUnitsLabel').textContent = t.waterUnitsLabel;
            document.getElementById('waterCostLabel').textContent = t.waterCostLabel;
            document.getElementById('estimatedLabel').textContent = t.estimatedLabel;
            document.getElementById('waterEstimatedLabel').textContent = t.waterEstimatedLabel;
            document.getElementById('prevLabel').textContent = t.prevLabel;
            document.getElementById('currentLabel').textContent = t.currentLabel;
            document.getElementById('waterPrevLabel').textContent = t.waterPrevLabel;
            document.getElementById('waterCurrentLabel').textContent = t.waterCurrentLabel;
            document.getElementById('units').placeholder = t.unitsPlaceholder;
            document.getElementById('cost').placeholder = t.costPlaceholder;
            document.getElementById('waterUnits').placeholder = t.waterUnitsPlaceholder;
            document.getElementById('waterCost').placeholder = t.waterCostPlaceholder;
            
            updateDisplay();
            updateWaterDisplay();
        }
        
        function setMode(mode) {
            currentMode = mode;
            
            if (currentSection === 'electricity') {
                document.getElementById('unitsBtn').classList.toggle('active', mode === 'units');
                document.getElementById('costBtn').classList.toggle('active', mode === 'cost');
                document.getElementById('unitsInput').style.display = mode === 'units' ? 'block' : 'none';
                document.getElementById('costInput').style.display = mode === 'cost' ? 'block' : 'none';
                document.getElementById('reverseResult').style.display = mode === 'cost' ? 'block' : 'none';
                updateDisplay();
            } else {
                document.getElementById('waterUnitsBtn').classList.toggle('active', mode === 'units');
                document.getElementById('waterCostBtn').classList.toggle('active', mode === 'cost');
                document.getElementById('waterUnitsInput').style.display = mode === 'units' ? 'block' : 'none';
                document.getElementById('waterCostInput').style.display = mode === 'cost' ? 'block' : 'none';
                document.getElementById('waterReverseResult').style.display = mode === 'cost' ? 'block' : 'none';
                updateWaterDisplay();
            }
        }
        
        const unitsInput = document.getElementById('units');
        const costInput = document.getElementById('cost');
        const totalCostEl = document.getElementById('totalCost');
        const breakdownEl = document.getElementById('breakdown');
        const currentCostEl = document.getElementById('currentCost');
        const currentBreakdownEl = document.getElementById('currentBreakdown');
        const estimatedUnitsEl = document.getElementById('estimatedUnits');
        
        const waterUnitsInput = document.getElementById('waterUnits');
        const waterCostInput = document.getElementById('waterCost');
        const waterTotalCostEl = document.getElementById('waterTotalCost');
        const waterBreakdownEl = document.getElementById('waterBreakdown');
        const waterCurrentCostEl = document.getElementById('waterCurrentCost');
        const waterCurrentBreakdownEl = document.getElementById('waterCurrentBreakdown');
        const waterEstimatedUnitsEl = document.getElementById('waterEstimatedUnits');
        
        function calculate2019Cost(units) {
            if (!units || units <= 0) {
                return { total: 0, breakdown: [] };
            }
            
            let cost = 0;
            let breakdown = [];
            
            if (units <= 3000) {
                cost = units * 0.003;
                breakdown.push({ range: `${units.toFixed(2)} ${translations[currentLang].units} Ã— 3 ${translations[currentLang].fils}`, cost: cost });
            } else {
                const first = 3000 * 0.003;
                cost += first;
                breakdown.push({ range: `3000 ${translations[currentLang].units} Ã— 3 ${translations[currentLang].fils}`, cost: first });
                
                if (units <= 5000) {
                    const second = (units - 3000) * 0.009;
                    cost += second;
                    breakdown.push({ range: `${(units - 3000).toFixed(2)} ${translations[currentLang].units} Ã— 9 ${translations[currentLang].fils}`, cost: second });
                } else {
                    const second = 2000 * 0.009;
                    cost += second;
                    breakdown.push({ range: `2000 ${translations[currentLang].units} Ã— 9 ${translations[currentLang].fils}`, cost: second });
                    
                    const third = (units - 5000) * 0.016;
                    cost += third;
                    breakdown.push({ range: `${(units - 5000).toFixed(2)} ${translations[currentLang].units} Ã— 16 ${translations[currentLang].fils}`, cost: third });
                }
            }
            
            return { total: cost, breakdown: breakdown };
        }
        
        function calculate2026Cost(units) {
            if (!units || units <= 0) {
                return { total: 0, breakdown: [] };
            }

            let cost = 0;
            let breakdown = [];

            if (units <= 3000) {
                cost = units * 0.003;
                breakdown.push({ range: `${units.toFixed(2)} ${translations[currentLang].units} Ã— 3 ${translations[currentLang].fils}`, cost });
            } else {
                const first = 3000 * 0.003;
                cost += first;
                breakdown.push({ range: `3000 ${translations[currentLang].units} Ã— 3 ${translations[currentLang].fils}`, cost: first });

                if (units <= 5000) {
                    const second = (units - 3000) * 0.009;
                    cost += second;
                    breakdown.push({ range: `${(units - 3000).toFixed(2)} ${translations[currentLang].units} Ã— 9 ${translations[currentLang].fils}`, cost: second });
                } else {
                    const second = 2000 * 0.009;
                    cost += second;
                    breakdown.push({ range: `2000 ${translations[currentLang].units} Ã— 9 ${translations[currentLang].fils}`, cost: second });

                    if (units <= 7000) {
                        const third = (units - 5000) * 0.012;
                        cost += third;
                        breakdown.push({ range: `${(units - 5000).toFixed(2)} ${translations[currentLang].units} Ã— 12 ${translations[currentLang].fils}`, cost: third });
                    } else {
                        const third = 2000 * 0.012;
                        cost += third;
                        breakdown.push({ range: `2000 ${translations[currentLang].units} Ã— 12 ${translations[currentLang].fils}`, cost: third });
                        
                        const fourth = (units - 7000) * 0.032;
                        cost += fourth;
                        breakdown.push({ range: `${(units - 7000).toFixed(2)} ${translations[currentLang].units} Ã— 32 ${translations[currentLang].fils}`, cost: fourth });
                    }
                }
            }

            return { total: cost, breakdown };
        }
        
        function calculateWater2019Cost(cubic) {
            if (!cubic || cubic <= 0) {
                return { total: 0, breakdown: [] };
            }
            
            let cost = 0;
            let breakdown = [];
            
            if (cubic <= 60) {
                cost = cubic * 0.025;
                breakdown.push({ range: `${cubic.toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 25 ${translations[currentLang].fils}`, cost: cost });
            } else {
                const first = 60 * 0.025;
                cost += first;
                breakdown.push({ range: `60 ${translations[currentLang].cubicMeters} Ã— 25 ${translations[currentLang].fils}`, cost: first });
                
                if (cubic <= 100) {
                    const second = (cubic - 60) * 0.080;
                    cost += second;
                    breakdown.push({ range: `${(cubic - 60).toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 80 ${translations[currentLang].fils}`, cost: second });
                } else {
                    const second = 40 * 0.080;
                    cost += second;
                    breakdown.push({ range: `40 ${translations[currentLang].cubicMeters} Ã— 80 ${translations[currentLang].fils}`, cost: second });
                    
                    const third = (cubic - 100) * 0.200;
                    cost += third;
                    breakdown.push({ range: `${(cubic - 100).toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 200 ${translations[currentLang].fils}`, cost: third });
                }
            }
            
            return { total: cost, breakdown: breakdown };
        }
        
        function calculateWater2026Cost(cubic) {
            if (!cubic || cubic <= 0) {
                return { total: 0, breakdown: [] };
            }
            
            let cost = 0;
            let breakdown = [];
            
            if (cubic <= 60) {
                cost = cubic * 0.025;
                breakdown.push({ range: `${cubic.toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 25 ${translations[currentLang].fils}`, cost: cost });
            } else {
                const first = 60 * 0.025;
                cost += first;
                breakdown.push({ range: `60 ${translations[currentLang].cubicMeters} Ã— 25 ${translations[currentLang].fils}`, cost: first });
                
                if (cubic <= 100) {
                    const second = (cubic - 60) * 0.080;
                    cost += second;
                    breakdown.push({ range: `${(cubic - 60).toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 80 ${translations[currentLang].fils}`, cost: second });
                } else {
                    const second = 40 * 0.080;
                    cost += second;
                    breakdown.push({ range: `40 ${translations[currentLang].cubicMeters} Ã— 80 ${translations[currentLang].fils}`, cost: second });
                    
                    const third = (cubic - 100) * 0.775;
                    cost += third;
                    breakdown.push({ range: `${(cubic - 100).toFixed(2)} ${translations[currentLang].cubicMeters} Ã— 775 ${translations[currentLang].fils}`, cost: third });
                }
            }
            
            return { total: cost, breakdown: breakdown };
        }
        
        function estimateUnitsFromCost(targetCost) {
            if (!targetCost || targetCost <= 0) return 0;
            
            // Determine which tier the cost falls into and calculate precise units
            if (targetCost <= 9.000) { // First tier only (3000 units * 0.003)
                return targetCost / 0.003;
            } else if (targetCost <= 27.000) { // First + Second tier (9 + 18)
                return 3000 + (targetCost - 9.000) / 0.009;
            } else { // All three tiers
                return 5000 + (targetCost - 27.000) / 0.016;
            }
        }
        
        function estimateWaterUnitsFromCost(targetCost) {
            if (!targetCost || targetCost <= 0) return 0;
            
            // Determine which tier the cost falls into and calculate precise cubic meters
            if (targetCost <= 1.500) { // First tier only (60 mÂ³ * 0.025)
                return targetCost / 0.025;
            } else if (targetCost <= 4.700) { // First + Second tier (1.5 + 3.2)
                return 60 + (targetCost - 1.500) / 0.080;
            } else { // All three tiers
                return 100 + (targetCost - 4.700) / 0.200;
            }
        }
        
        function updateDisplay() {
            const t = translations[currentLang];
            let units = 0;
            
            if (currentMode === 'units') {
                units = parseFloat(unitsInput.value) || 0;
            } else {
                const cost = parseFloat(costInput.value) || 0;
                units = estimateUnitsFromCost(cost);
                estimatedUnitsEl.textContent = units > 0 ? units.toFixed(2) : '0';
            }
            
            const result = calculate2019Cost(units);
            totalCostEl.textContent = `${result.total.toFixed(3)} BD`;
            
            if (result.breakdown.length > 0) {
                breakdownEl.innerHTML = result.breakdown.map(item => 
                    `<div class="breakdown-item">
                        <span>${item.range}</span>
                        <span>${item.cost.toFixed(3)} BD</span>
                    </div>`
                ).join('');
            } else {
                breakdownEl.innerHTML = '';
            }
            
            const currentResult = calculate2026Cost(units);
            currentCostEl.textContent = `${currentResult.total.toFixed(3)} BD`;
            
            if (currentResult.breakdown.length > 0) {
                const diff = currentResult.total - result.total;
                const diffText = diff > 0 ? `+${diff.toFixed(3)} BD ${t.more}` : diff < 0 ? `${Math.abs(diff).toFixed(3)} BD ${t.less}` : t.sameCost;
                
                let html = currentResult.breakdown.map(item => 
                    `<div class="breakdown-item">
                        <span>${item.range}</span>
                        <span>${item.cost.toFixed(3)} BD</span>
                    </div>`
                ).join('');
                
                if (units > 0) {
                    html += `<div class="breakdown-item" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3); font-weight: bold;">
                        <span>${t.difference}</span>
                        <span>${diffText}</span>
                    </div>`;
                }
                
                currentBreakdownEl.innerHTML = html;
            } else {
                currentBreakdownEl.innerHTML = '';
            }
        }
        
        function updateWaterDisplay() {
            const t = translations[currentLang];
            let cubic = 0;
            
            if (currentMode === 'units') {
                cubic = parseFloat(waterUnitsInput.value) || 0;
            } else {
                const cost = parseFloat(waterCostInput.value) || 0;
                cubic = estimateWaterUnitsFromCost(cost);
                waterEstimatedUnitsEl.textContent = cubic > 0 ? cubic.toFixed(2) : '0';
            }
            
            const result = calculateWater2019Cost(cubic);
            waterTotalCostEl.textContent = `${result.total.toFixed(3)} BD`;
            
            if (result.breakdown.length > 0) {
                waterBreakdownEl.innerHTML = result.breakdown.map(item => 
                    `<div class="breakdown-item">
                        <span>${item.range}</span>
                        <span>${item.cost.toFixed(3)} BD</span>
                    </div>`
                ).join('');
            } else {
                waterBreakdownEl.innerHTML = '';
            }
            
            const currentResult = calculateWater2026Cost(cubic);
            waterCurrentCostEl.textContent = `${currentResult.total.toFixed(3)} BD`;
            
            if (currentResult.breakdown.length > 0) {
                const diff = currentResult.total - result.total;
                const diffText = diff > 0 ? `+${diff.toFixed(3)} BD ${t.more}` : diff < 0 ? `${Math.abs(diff).toFixed(3)} BD ${t.less}` : t.sameCost;
                
                let html = currentResult.breakdown.map(item => 
                    `<div class="breakdown-item">
                        <span>${item.range}</span>
                        <span>${item.cost.toFixed(3)} BD</span>
                    </div>`
                ).join('');
                
                if (cubic > 0) {
                    html += `<div class="breakdown-item" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3); font-weight: bold;">
                        <span>${t.difference}</span>
                        <span>${diffText}</span>
                    </div>`;
                }
                
                waterCurrentBreakdownEl.innerHTML = html;
            } else {
                waterCurrentBreakdownEl.innerHTML = '';
            }
        }
        
        unitsInput.addEventListener('input', updateDisplay);
        costInput.addEventListener('input', updateDisplay);
        waterUnitsInput.addEventListener('input', updateWaterDisplay);
        waterCostInput.addEventListener('input', updateWaterDisplay);
        updateDisplay();
        updateWaterDisplay();
    </script>
</body>
</html>
